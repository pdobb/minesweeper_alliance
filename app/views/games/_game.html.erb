<%# locals: (view:) %>

<%= turbo_frame_tag(view.turbo_frame_identifer) do %>
  <div class="grid gap-y-6 justify-center">
    <% if view.game_in_progress? %>
      <div
        data-controller="board-actions"
        data-board-actions-board-id-value="gameBoard"
        class="text-center"
      >
        <%= link_to(
              "Reveal Random",
              "",
              class: "btn-primary",
              data: {
                turbo_method: :post,
                action: "board-actions#revealRandom:prevent"
              }) %>
      </div>
    <% else # view.game_over? %>
      <p class="text-center"><%= view.game_result %></p>
    <% end %>

    <table id="gameBoard" class="mx-auto table-fixed select-none">
      <tbody
        <% if view.game_in_progress? %>
          data-controller="board"
          data-board-action-proxy-id-value="boardActionProxy"
          data-board-reveal-url-value="<%= view.reveal_url %>"
          data-board-toggle-flag-url-value="<%= view.toggle_flag_url %>"
          data-board-reveal-neighbors-url-value="<%= view.reveal_neighbors_url %>"
          data-action="
            click->board#reveal
            contextmenu->board#toggleFlag:prevent
            dblclick->board#revealNeighbors
          "
        <% end %>
        class="
          <%# Cells %>
          *:*:size-8 *:*:min-w-8 *:*:min-h-8
          *:*:border *:*:border-slate-600
          *:*:text-center
          <% if view.game_in_progress? %>
            data-[revealed=false]:*:*:cursor-cell
            data-[revealed=true]:*:*:cursor-default
          <% else %>
            *:*:cursor-default
          <% end %>
        "
      >
        <% view.board_rows.each do |row| %>
          <tr>
            <% row.each do |cell| %>
              <td
                data-id="<%= cell.id %>"
                data-revealed="<%= cell.revealed? %>"
                data-flagged="<%= cell.flagged? %>"
                class="<%= class_names(cell.css_class) %>"
              >
                <%= cell %>
              </td>
            <% end %>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

  <%= link_to(
        nil,
        "",
        id: "boardActionProxy",
        class: "hidden",
        data: { turbo_method: :post }) %>
<% end %>
