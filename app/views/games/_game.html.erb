<%# locals: (view:) %>

<%= turbo_frame_tag(view.turbo_frame_identifer) do %>
  <div
    class="
      mb-6 min-h-12
      grid grid-cols-3 items-center
    "
  >
    <div class="text-lg text-left sm:text-center lg:text-right">
      <%# TODO: Timer %>
    </div>

    <% if view.game_in_progress? %>
      <div
        data-controller="board-actions"
        data-board-actions-board-id-value="gameBoard"
        class="text-center"
      >
        <%= button_to(
              "Reveal Random",
              nil,
              class: "btn-primary",
              data: { action: "board-actions#revealRandom:prevent" }) %>
      </div>
    <% else # view.game_over? %>
      <h2 class="text-center whitespace-nowrap">
        <%= view.game_result %>
      </h2>
    <% end %>

    <div
      class="text-lg text-right sm:text-center lg:text-left"
      title="Unmarked Mines Remaining"
    >
      <%= view.unmarked_mines_remaining %>
      <%= view.flag_icon %>
    </div>
  </div>

  <div class="grid gap-y-3 justify-center">
    <table
      id="gameBoard"
      class="mx-auto table-fixed select-none"
    >
      <tbody
        <% if view.game_in_progress? %>
          data-controller="board"
          data-board-action-proxy-id-value="boardActionProxy"
          data-board-reveal-url-value="<%= view.reveal_url %>"
          data-board-toggle-flag-url-value="<%= view.toggle_flag_url %>"
          data-board-reveal-neighbors-url-value="<%= view.reveal_neighbors_url %>"
          data-action="
            click->board#reveal
            contextmenu->board#toggleFlag:prevent
            dblclick->board#revealNeighbors
          "
        <% end %>
        class="
          <%# Cells %>
          *:*:size-8 *:*:min-w-8 *:*:min-h-8
          *:*:border *:*:border-slate-600
          *:*:text-center
          <% if view.game_in_progress? %>
            data-[revealed=false]:*:*:cursor-cell
            data-[revealed=true]:*:*:cursor-default
          <% else %>
            *:*:cursor-default
          <% end %>
        "
      >
        <% view.board_rows.each do |row| %>
          <tr>
            <% row.each do |cell| %>
              <td
                data-id="<%= cell.id %>"
                data-revealed="<%= cell.revealed? %>"
                data-flagged="<%= cell.flagged? %>"
                class="<%= class_names(cell.css_class) %>"
              >
                <%= cell %>
              </td>
            <% end %>
          </tr>
        <% end %>
      </tbody>
    </table>

    <ul class="flex justify-end items-center gap-x-6 text-gray-500">
      <li><%= view.difficulty_level_name %></li>
      <li><%= view.cell_icon %> <%= view.board_dimensions %></li>
      <li><%= view.mine_icon %> x<%= view.mines_count %></li>
    </ul>
  </div>

  <%= link_to(
        nil,
        "",
        id: "boardActionProxy",
        class: "hidden",
        data: { turbo_method: :post }) %>
<% end %>
