<%# locals: (view:) %>

<%= turbo_frame_tag(view.turbo_frame_identifer) do %>
  <div class="grid gap-y-6 justify-center">
    <% if view.game_in_progress? %>
      <div
        data-controller="board"
        class="text-center"
      >
        <%= link_to(
              "Reveal a Random Cell",
              view.reveal_random_url,
              id: "reveal",
              class: "btn-primary",
              data: {
                turbo_method: :post,
                action: "board#revealRandom"
              }) %>
        <% with_options(class: "hidden", data: { turbo_method: :post }) do |o| %>
          <%= o.link_to("", view.toggle_flag_url, id: "toggleFlag") %>
          <%= o.link_to("", view.reveal_neighbors_url, id: "revealNeighbors") %>
        <% end %>
      </div>
    <% else # view.game_over? %>
      <p class="text-center"><%= view.game_result %></p>
    <% end %>

    <table class="mx-auto table-fixed select-none">
      <tbody
        <% if view.game_in_progress? %>
          data-controller="board"
          data-action="
            click->board#reveal
            contextmenu->board#toggleFlag:prevent
            dblclick->board#revealNeighbors
          "
        <% end %>
        class="
          <%# Cells %>
          *:*:size-8 *:*:min-w-8 *:*:min-h-8
          *:*:border *:*:border-slate-600
          *:*:text-center
          <% if view.game_in_progress? %>
            data-[revealed=false]:*:*:cursor-cell
            data-[revealed=true]:*:*:cursor-default
          <% else %>
            *:*:cursor-default
          <% end %>
        "
      >
        <% view.board_rows.each do |row| %>
          <tr>
            <% row.each do |cell| %>
              <td
                data-id="<%= cell.id %>"
                data-revealed="<%= cell.revealed? %>"
                class="<%= class_names(cell.css_class) %>"
              >
                <%= cell %>
              </td>
            <% end %>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
<% end %>
