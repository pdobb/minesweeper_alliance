<%# locals: (view:) %>

<%= turbo_frame_tag(view.turbo_frame_identifer) do %>
  <div class="flex flex-col gap-y-6 items-center">
    <h2><%= view.status %></h2>

    <table id="gameBoard" class="mx-auto table-fixed select-none">
      <thead>
        <tr>
          <td colspan="100%" class="pb-3">
            <div class="text-lg flex justify-between">
              <div
                <% if view.game_on? %>
                  data-controller="elapsed-time"
                  data-elapsed-time-start-value="<%= view.elapsed_time.to_i %>"
                <% end %>
              >
                <span data-elapsed-time-target="elapsedTime">
                  <%= view.elapsed_time %>
                </span>
              </div>

              <div title="Unmarked Mines Remaining">
                <%= view.unmarked_mines_remaining %>
                <%= view.flag_icon %>
              </div>
            </div>
          </td>
        </tr>
      </thead>
      <tbody
        <% if view.game_on? %>
          data-controller="board"
          data-board-action-proxy-id-value="boardActionProxy"
          data-board-reveal-url-value="<%= view.reveal_url %>"
          data-board-toggle-flag-url-value="<%= view.toggle_flag_url %>"
          data-board-reveal-neighbors-url-value="<%= view.reveal_neighbors_url %>"
          data-action="
            click->board#reveal
            contextmenu->board#toggleFlag:prevent
            click->board#revealNeighbors
          "
        <% end %>
        class="
          text-center

          <%# Cells %>
          *:*:size-8 *:*:min-w-8 *:*:min-h-8
          *:*:border *:*:border-slate-600
          <% if view.game_on? %>
            data-[revealed=false]:*:*:cursor-cell
            data-[revealed=true]:*:*:cursor-default
          <% else %>
            *:*:cursor-default
          <% end %>
        "
      >
        <% view.board_rows.each do |row| %>
          <tr>
            <% row.each do |cell| %>
              <td
                data-id="<%= cell.id %>"
                data-revealed="<%= cell.revealed? %>"
                data-flagged="<%= cell.flagged? %>"
                class="<%= class_names(cell.css_class) %>"
              >
                <%= cell %>
              </td>
            <% end %>
          </tr>
        <% end %>
      </tbody>
    </table>

    <% if view.game_on? %>
      <div
        data-controller="board-actions"
        data-board-actions-board-id-value="gameBoard"
      >
        <%= button_to(
              "Reveal Random",
              nil,
              class: "btn-primary",
              data: { action: "board-actions#revealRandom:prevent" }) %>
      </div>
    <% end %>
  </div>

  <%= link_to(
        nil,
        "",
        id: "boardActionProxy",
        class: "hidden",
        data: { turbo_method: :post }) %>
<% end %>
